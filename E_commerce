CREATE DATABASE E_COMMERCE
USE E_COMMERCE

CREATE TABLE CUSTOMER
(
CUSTOMER_ID INT,
CUSTOMER_NAME VARCHAR(50),
CUSTOMER_CITY VARCHAR(20)
)

CREATE TABLE PRODUCTT
(
PRODUCT_ID  INT,
PRODUCT_NAME VARCHAR(50),
CATEGORY VARCHAR(50),
PRICE INT
)

CREATE TABLE ORDERS
(
ORDER_ID INT,
CUSTOMER_ID INT,
ORDER_DATE DATE
)

CREATE TABLE PAYMENTS
(
PAYMENT_ID INT,
ORDER_ID INT,
QUANTITY INT,
PAYMENT_MORE VARCHAR,
TOTAL_AMOUNT INT
)



INSERT INTO CUSTOMER VALUES (1,'MOHAN','HYDRABAD')
INSERT INTO CUSTOMER VALUES(2,'MURARI','AMMERPET')
INSERT INTO CUSTOMER VALUES(3,'DIMPLE','SR NAGAR')
INSERT INTO CUSTOMER VALUES(4,'GANESH','CHINTHALL')
INSERT INTO CUSTOMER VALUES(5,'LOKI','KPHB')
INSERT INTO CUSTOMER VALUES(6,'NARENDRA','BEGUMPET')


INSERT INTO PRODUCTT VALUES(101,'LAPTOP','ELECTRONICS',60000)
INSERT INTO PRODUCTT VALUES(102,'MOBILE','ELECTRONICS',50000)
INSERT INTO PRODUCTT VALUES(103,'SHOES','FASHION',2000)
INSERT INTO PRODUCTT VALUES(104,'CHOCLATES','FOOD',1000)
INSERT INTO PRODUCTT VALUES(105,'SHIRTS','FASHION',1000)

INSERT INTO ORDERS VALUES(501,1,'2025-01-10')
INSERT INTO ORDERS VALUES(502,2,'2025-02-12')
INSERT INTO ORDERS VALUES(503,3,'2024-03-11')
INSERT INTO ORDERS VALUES(504,4,'2024-02-15')
INSERT INTO ORDERS VALUES(505,5,'2023-11-22')
INSERT INTO ORDERS VALUES(506,6,'2025-11-10')
INSERT INTO ORDERS VALUES(507,3,'2025-03-11')
INSERT INTO ORDERS VALUES(508,5,'2025-02-15')
INSERT INTO ORDERS VALUES(509,2,'2023-11-27')
INSERT INTO ORDERS VALUES(510,6,'2025-05-11')

INSERT INTO PAYMENTS VALUES(1001,501,1,'U',60000)
INSERT INTO PAYMENTS VALUES(1002,502,2,'C',100000)
INSERT INTO PAYMENTS VALUES(1003,503,1,'A',2000)
INSERT INTO PAYMENTS VALUES(1004,504,3,'P',3000)
INSERT INTO PAYMENTS VALUES(1005,505,2,'G',2000)
INSERT INTO PAYMENTS VALUES(1006,506,1,'M',2000)

SELECT * FROM CUSTOMER
SELECT * FROM PRODUCTT
SELECT * FROM ORDERS
SELECT * FROM PAYMENTS


---Display All Order Details with Customer and Payment Info--
SELECT O.ORDER_ID,O.CUSTOMER_ID,C.CUSTOMER_NAME,C.CUSTOMER_CITY,O.ORDER_DATE,P.PAYMENT_ID,P.PAYMENT_MORE,P.TOTAL_AMOUNT
FROM ORDERS O
INNER JOIN
CUSTOMER C ON O.CUSTOMER_ID=C.CUSTOMER_ID
INNER JOIN
PAYMENTS P ON O.ORDER_ID=P.ORDER_ID

--- Total Sales Amount per Customer (JOIN + GROUP BY)

SELECT C.CUSTOMER_ID,C.CUSTOMER_NAME,C.CUSTOMER_CITY,O.ORDER_ID,P.TOTAL_AMOUNT,P.QUANTITY,SUM(P.TOTAL_AMOUNT*P.QUANTITY)AS FINAL_BILL
FROM ORDERS O
INNER JOIN
CUSTOMER C ON O.CUSTOMER_ID=C.CUSTOMER_ID
INNER JOIN
PAYMENTS P ON O.ORDER_ID=P.ORDER_ID
GROUP BY C.CUSTOMER_ID,C.CUSTOMER_NAME,C.CUSTOMER_CITY,O.ORDER_ID,P.TOTAL_AMOUNT,P.QUANTITY
ORDER BY FINAL_BILL DESC;

--Total Revenue by Year (GROUP BY with DATE Functions)--

SELECT C.CUSTOMER_ID,C.CUSTOMER_NAME,C.CUSTOMER_CITY,P.QUANTITY,YEAR(O.ORDER_DATE) AS YEARR ,SUM(P.TOTAL_AMOUNT) AS REVENUE
FROM ORDERS O
INNER JOIN
CUSTOMER C ON O.CUSTOMER_ID=C.CUSTOMER_ID
INNER JOIN
PAYMENTS P ON O.ORDER_ID=P.ORDER_ID
GROUP BY C.CUSTOMER_ID,C.CUSTOMER_NAME,C.CUSTOMER_CITY,P.QUANTITY,YEAR(O.ORDER_DATE)


SELECT YEAR(O.ORDER_DATE) AS YEARR ,SUM(P.TOTAL_AMOUNT) AS REVENUE
FROM ORDERS O
INNER JOIN 
PAYMENTS P ON O.ORDER_ID=P.ORDER_ID
GROUP BY YEAR(O.ORDER_DATE)

---Find Orders ABOVE Average Payment (SUBQUERY)--
SELECT O.ORDER_ID,P.TOTAL_AMOUNT
FROM ORDERS O
INNER JOIN 
PAYMENTS P ON O.ORDER_ID=P.ORDER_ID
WHERE P.TOTAL_AMOUNT > ( SELECT AVG(TOTAL_AMOUNT) FROM PAYMENTS)

---Find Orders BELOW Average Payment (SUBQUERY)--
SELECT O.ORDER_ID,P.TOTAL_AMOUNT
FROM ORDERS O
INNER JOIN 
PAYMENTS P ON O.ORDER_ID=P.ORDER_ID
WHERE P.TOTAL_AMOUNT < ( SELECT AVG(TOTAL_AMOUNT) FROM PAYMENTS)

--Count of Orders per City (JOIN + GROUP BY)--
SELECT C.CUSTOMER_NAME,C.CUSTOMER_CITY,O.ORDER_ID,COUNT(O.ORDER_ID) AS YYY
FROM ORDERS O
INNER JOIN
CUSTOMER C ON O.CUSTOMER_ID=C.CUSTOMER_ID
GROUP BY C.CUSTOMER_ID,C.CUSTOMER_NAME,C.CUSTOMER_CITY,O.ORDER_ID

SELECT 
    C.CUSTOMER_CITY,
    COUNT(O.ORDER_ID) AS TOTAL_ORDERS
FROM CUSTOMER C
JOIN ORDERS O ON C.CUSTOMER_ID = O.CUSTOMER_ID
GROUP BY C.CUSTOMER_CITY
ORDER BY TOTAL_ORDERS DESC;


--Find Highest  (SUBQUERY)----

SELECT O.CUSTOMER_ID,C.CUSTOMER_NAME,O.ORDER_ID,P.PAYMENT_MORE,P.TOTAL_AMOUNT
FROM ORDERS O
INNER JOIN CUSTOMER C
ON O.CUSTOMER_ID=C.CUSTOMER_ID
INNER JOIN PAYMENTS P
ON O.ORDER_ID=P.ORDER_ID
WHERE P.TOTAL_AMOUNT = (SELECT MAX(TOTAL_AMOUNT) FROM PAYMENTS)


SELECT * FROM PAYMENTS
WHERE TOTAL_AMOUNT=(SELECT MAX(TOTAL_AMOUNT)FROM PAYMENTS)


---and Lowest (SUBQUERY)----

SELECT O.CUSTOMER_ID,C.CUSTOMER_NAME,O.ORDER_ID,P.PAYMENT_MORE,P.TOTAL_AMOUNT
FROM ORDERS O
INNER JOIN CUSTOMER C
ON O.CUSTOMER_ID=C.CUSTOMER_ID
INNER JOIN PAYMENTS P
ON O.ORDER_ID=P.ORDER_ID
WHERE P.TOTAL_AMOUNT = (SELECT MIN(TOTAL_AMOUNT) FROM PAYMENTS)


---and Lowest (SUBQUERY)----

SELECT * FROM PAYMENTS
WHERE TOTAL_AMOUNT=(SELECT MIN(TOTAL_AMOUNT)FROM PAYMENTS)

----Find Total Quantity and Revenue (SUM + GROUP BY)-----

SELECT  SUM (P.QUANTITY) AS QUAN FROM PAYMENTS P
SELECT  SUM (P.TOTAL_AMOUNT) AS TOTAL FROM PAYMENTS P


